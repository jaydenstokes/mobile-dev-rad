<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col flex-1 items-center justify-center min-h-screen gap-2">
    <h1 id="rolled-number" class="text-8xl font-bold">
      {{ initial_number }}
    </h1>
    <p id="rolled" class="text-4xl"></p>
    <p id="score">Your Score: 0</p>
    <p id="highscore">Highscore: 0</p>
    <div class="flex flex-row gap-2">
        <button id="higher" class="border p-1 rounded-md" onclick="rollDie('higher')">Higher</button>
        <button id="equal" class="border p-1 rounded-md" onclick="rollDie('equal')">Equal</button>
        <button id="lower" class="border p-1 rounded-md" onclick="rollDie('lower')">Lower</button>
    </div>
    <p id="answered"></p>
</body>
<script>
    const diceFaces = {
        1: '⚀',
        2: '⚁',
        3: '⚂',
        4: '⚃',
        5: '⚄',
        6: '⚅'
    };

    const delay = ms => new Promise(res => setTimeout(res, ms));
    const scoreElement = document.getElementById('score');
    const highscoreElement = document.getElementById('highscore');
    const rolledElement = document.getElementById('rolled-number');
    const youRolledElement = document.getElementById('rolled');
    const answeredElement = document.getElementById('answered');

    let canContinue = true;

    async function rollDie(prediction) {
        const previousNumber = document.getElementById('rolled-number').textContent;

        if (!canContinue) return;
        canContinue = false;

        for (let i = 1; i < 10; i++) {
            const number = Math.floor(5 * Math.random()) + 1;
            youRolledElement.innerText = `${diceFaces[number]}`;
            await delay(100);
        }

        const res = await fetch('/roll', {
            method: "POST",
            headers: {
                'content-type': 'application/json'
            },
            body: JSON.stringify({
                prediction: prediction,
                previous: parseInt(previousNumber)
            })
        });

        canContinue = true;
        const body = await res.json();

        if (body) {
            rolledElement.innerText = body.roll;
            youRolledElement.innerText = `${diceFaces[body.roll]}`;
            scoreElement.innerText = `Your Score: ${body.score}`;
            highscoreElement.innerText = `Highscore: ${body.highscore}`;

            if (body.win) {
                answeredElement.className = "text-green-400"
                answeredElement.innerText = "You answered correctly!"
            } else {
                answeredElement.className = "text-red-400"
                answeredElement.innerText = "You answered incorrectly!"
            }
        }
    }
</script>
</html>